const EXPERIENCES = [
  {
    "skills": [],
    "starts_at": {
      "day": 1,
      "month": 6,
      "year": 2023,
    },
    "ends_at": null,
    "company": "adidas",
    "company_linkedin_profile_url": "https://www.linkedin.com/company/adidas/",
    "title": "Software Engineer",
    "description": null,
    "logo_url":
      "https://s3.us-west-000.backblazeb2.com/proxycurl/company/adidas/profile?X-Amz-Algorithm=AWS4-HMAC-SHA256&X-Amz-Credential=0004d7f56a0400b0000000001%2F20230425%2Fus-west-000%2Fs3%2Faws4_request&X-Amz-Date=20230425T203124Z&X-Amz-Expires=1800&X-Amz-SignedHeaders=host&X-Amz-Signature=c1647197713b255f4769959d2318c5d97f7c8d1b8e211355d50315fb394793a6",
  },
  {
    "starts_at": {
      "day": 1,
      "month": 11,
      "year": 2021,
    },
    "ends_at": {
      "day": 1,
      "month": 5,
      "year": 2023,
    },
    "company": "adidas",
    "company_linkedin_profile_url": "https://www.linkedin.com/company/adidas/",
    "title": "Software Developer",
    "description": null,
    "logo_url":
      "https://s3.us-west-000.backblazeb2.com/proxycurl/company/adidas/profile?X-Amz-Algorithm=AWS4-HMAC-SHA256&X-Amz-Credential=0004d7f56a0400b0000000001%2F20230425%2Fus-west-000%2Fs3%2Faws4_request&X-Amz-Date=20230425T203124Z&X-Amz-Expires=1800&X-Amz-SignedHeaders=host&X-Amz-Signature=c1647197713b255f4769959d2318c5d97f7c8d1b8e211355d50315fb394793a6",
  },
  {
    "starts_at": {
      "day": 1,
      "month": 3,
      "year": 2021,
    },
    "ends_at": {
      "day": 1,
      "month": 10,
      "year": 2021,
    },
    "company": "Smart Servant",
    "company_linkedin_profile_url":
      "https://www.linkedin.com/company/smartservant/",
    "title": "Full Stack Developer",
    "description":
      "Worked as a full-stack developer focused on developing IoT solutions for delivery and room service robots. Developed a progressive web app (PWA) where a user interacts with the robots and nodejs backend API which handles interaction between the app and the robots.\nDeliverables\n1. Progressive Web App (PWA) build with Vue (frontend framework) and vuetify (design components library)\n2. Backend API build with nodejs and express",
    "location": "De Maas 8, Best, the Netherlands",
    "logo_url":
      "https://media.licdn.com/dms/image/C4E0BAQFPM_dTj28WuQ/company-logo_400_400/0/1623921801125?e=1689811200&v=beta&t=2lck4bT3FYROagWSYCCM-5fri-fLG8LpLyI57Tb5eeQ",
  },
  {
    "starts_at": {
      "day": 1,
      "month": 9,
      "year": 2020,
    },
    "ends_at": {
      "day": 1,
      "month": 2,
      "year": 2021,
    },
    "company": "No1Robotics B.V",
    "company_linkedin_profile_url":
      "https://www.linkedin.com/company/no1robotics/",
    "title": "Full Stack Developer",
    "description":
      "Migration and Improvements of Geriatrie Project: The project aims to migrate “Geriatrie Pepper” web app into Geriatrie android application with some improvements in design. And decoupling “Geriatrie Admin” from a pepper robot platform and rewriting of “Geriatrie Admin” web app into Geriatrie Content Management System (CMS) by making responsive design and improving designs. \nThe project uses the following technologies.\n1.\tAndroid Studio with kotlin language to develop an android application\n2.\tGoogle Material Design Components\n3.\tFrontend framework Vue.js with Vuetify.js (design components library) to build an interactive user interface for CMS\n4.\tFirebase as an application backend\n5.\tGoogle Cloud Platform\n6.\tBit cloud to share the common user interface components across projects\n7.\tJira Software and Confluence as the project management tool",
    "location": "De Maas 8, Best",
    "logo_url":
      "https://media.licdn.com/dms/image/C560BAQHxgcD0Vxiu1g/company-logo_400_400/0/1578487845162?e=1689811200&v=beta&t=tl7Jc33FY0b2sAK5JwjtwNCy7o8iw82VDGougNyKVRw",
  },
  {
    "starts_at": {
      "day": 1,
      "month": 6,
      "year": 2020,
    },
    "ends_at": {
      "day": 1,
      "month": 8,
      "year": 2020,
    },
    "company": "No1Robotics B.V",
    "company_linkedin_profile_url":
      "https://www.linkedin.com/company/no1robotics/",
    "title": "Full Stack Developer",
    "description":
      "Migration, Improvements and Extensions of KinderPoli (PiPo) Project: The project aims to migrate “PiPo Pepper” web app into KinderPoli android application with some improvements in the design and addition of new functionalities. And decoupling “PiPo Admin” from pepper robot platform and rewriting of “PiPo Admin” web app into KinderPoli Content Management System (CMS) by making responsive design with some new functionalities.\nThe project uses the following technologies.\n1. Android Studio with kotlin language to develop an android application\n2. Google Material Design Components\n3. Frontend framework Vue.js with Vuetify.js (design components library) to build an interactive user interface for CMS\n4. Firebase as an application backend\n5. Google Cloud Platform\n6. Bit cloud to share the common user interface components across projects\n7. Jira Software and Confluence as project management tool",
    "location": "Best, North Brabant, Netherlands",
    "logo_url":
      "https://media.licdn.com/dms/image/C560BAQHxgcD0Vxiu1g/company-logo_400_400/0/1578487845162?e=1689811200&v=beta&t=tl7Jc33FY0b2sAK5JwjtwNCy7o8iw82VDGougNyKVRw",
  },
  {
    "starts_at": {
      "day": 1,
      "month": 1,
      "year": 2020,
    },
    "ends_at": {
      "day": 1,
      "month": 5,
      "year": 2020,
    },
    "company": "No1Robotics B.V",
    "company_linkedin_profile_url":
      "https://www.linkedin.com/company/no1robotics/",
    "title": "Full Stack Developer",
    "description":
      "Migration, Improvements and Extensions of Geriatrie Project: The project aims to migrate “Geriatrie” app, which was developed during the Graduation Project, improving development workflow & designs and adding some new functionalities.\nThe project uses the following technologies.\n1.\tFrontend framework Vue.js with Bootstrap-Vue (design components library) to build an interactive user interface\n2.\tFirebase as an application backend\n3.\tGoogle Cloud Platform\n4.\tTrello as a project management tool",
    "location": "Best, North Brabant, Netherlands",
    "logo_url":
      "https://media.licdn.com/dms/image/C560BAQHxgcD0Vxiu1g/company-logo_400_400/0/1578487845162?e=1689811200&v=beta&t=tl7Jc33FY0b2sAK5JwjtwNCy7o8iw82VDGougNyKVRw",
  },
  {
    "starts_at": {
      "day": 1,
      "month": 2,
      "year": 2019,
    },
    "ends_at": {
      "day": 1,
      "month": 12,
      "year": 2019,
    },
    "company": "No1Robotics B.V",
    "company_linkedin_profile_url":
      "https://www.linkedin.com/company/no1robotics/",
    "title": "Full Stack Developer",
    "description":
      "Project PiPo: The project aims to develop two web apps. First, “PiPo Pepper” an app which is used by a health care professional during a training session about pee and poo problems to a kid.  Second, “PiPo Admin” an app which is used by the health care professional to manage the contents that are used during the training session.\nThe project uses the following technologies\n1.\tFrontend framework Vue.js with Bootstrap-Vue (design components library) to build an interactive user interface\n2.\tFirebase as an application backend\n3.\tGoogle Cloud Platform\n4.\tTrello as project management tool",
    "location": "Best, North Brabant, Netherlands",
    "logo_url":
      "https://media.licdn.com/dms/image/C560BAQHxgcD0Vxiu1g/company-logo_400_400/0/1578487845162?e=1689811200&v=beta&t=tl7Jc33FY0b2sAK5JwjtwNCy7o8iw82VDGougNyKVRw",
  },
  {
    "starts_at": {
      "day": 1,
      "month": 9,
      "year": 2018,
    },
    "ends_at": {
      "day": 1,
      "month": 1,
      "year": 2019,
    },
    "company": "No1Robotics B.V",
    "company_linkedin_profile_url":
      "https://www.linkedin.com/company/no1robotics/",
    "title": "Full Stack Developer (Graduation Internship)",
    "description":
      'Health care, Maxima Medisch Centrum (MMC) wants to put the social humanoid robot "Pepper" into their working environment to solve the problems of elderly people being frustrated during the stay in health care and their care professionals were not able to be with the patients more time to make them engaged.  \nTherefore, an assignment was to develop a web-based application for pepper robot which helps them to keep their patients (especially old people) entertained and engaged during the stay in health care by introducing pepper robot onto their working environment. The pepper will be a colleague of the health care professional and work with them together.',
    "location": "oss, Netherlands",
    "logo_url":
      "https://media.licdn.com/dms/image/C560BAQHxgcD0Vxiu1g/company-logo_400_400/0/1578487845162?e=1689811200&v=beta&t=tl7Jc33FY0b2sAK5JwjtwNCy7o8iw82VDGougNyKVRw",
  },
  {
    "starts_at": {
      "day": 1,
      "month": 2,
      "year": 2017,
    },
    "ends_at": {
      "day": 1,
      "month": 7,
      "year": 2017,
    },
    "company": "Bosch Security Systems",
    "company_linkedin_profile_url":
      "https://www.linkedin.com/company/bosch-security-systems/",
    "title": "Backend C# developer (Internship)",
    "description":
      "Developing a prototype algorithm for OMNEO platform which can differentiate network quality based on the amount of jitter accumulated in the network system.",
    "location": "Breda Area, Netherlands",
    "logo_url":
      "https://s3.us-west-000.backblazeb2.com/proxycurl/company/bosch-security-systems/profile?X-Amz-Algorithm=AWS4-HMAC-SHA256&X-Amz-Credential=0004d7f56a0400b0000000001%2F20230425%2Fus-west-000%2Fs3%2Faws4_request&X-Amz-Date=20230425T203124Z&X-Amz-Expires=1800&X-Amz-SignedHeaders=host&X-Amz-Signature=82160cbfef9bdcf6ab0282da3363d05d47837dc1191dcf1bc1afb5fe62712611",
  },
];

type Experience = typeof EXPERIENCES[number] & {
  nestedExperiences: typeof EXPERIENCES[number][];
};

export default function Experience() {
  const experiences = EXPERIENCES.map((exp) => ({
    ...exp,
    nestedExperiences: [],
  })).reduce<Experience[]>((acc, exp) => {
    const index = acc.findIndex((e) => e.company === exp.company);

    if (index === -1) {
      acc.push(exp);
      acc[acc.length - 1].nestedExperiences.push(exp);
    } else {
      acc[index].nestedExperiences.push(exp);
    }

    return acc;
  }, []);

  return (
    <div className="w-full sm:w-1/2">
      <h4 className="text-2xl font-semibold text-teal-500">Experience</h4>

      {experiences.map((exp, i) => (
        <div
          className="mt-4
            border-l-4 border-teal-500 p-4 bg-slate-50 dark:bg-slate-800 rounded-lg shadow-md transition-transform hover:scale-105 duration-300 ease-in-out"
          key={i}
        >
          <p className="text-lg font-semibold text-slate-900 dark:text-slate-100 uppercase">
            {exp.company}
          </p>
          <p className="text-lg text-slate-500 dark:text-slate-400">
            Full time - {calculateWorkDuration(
              exp.nestedExperiences[
                exp.nestedExperiences.length - 1
              ].starts_at,
              exp.nestedExperiences[0].ends_at,
            )}
          </p>
          <p className="text-lg text-slate-500 dark:text-slate-400">
            {exp.location}
          </p>

          {exp.nestedExperiences.map((ex) => (
            <div className="mt-2">
              <h5 className="text-lg font-semibold text-slate-900 dark:text-slate-100">
                {ex.title}
              </h5>
              <p className="text-lg text-slate-500 dark:text-slate-400">
                {`${formateDate(ex.starts_at)} - ${formateDate(ex.ends_at)}`}
              </p>

              <p className="mt-2 text-lg text-slate-700 dark:text-slate-100 whitespace-pre-line">
                {ex.description}
              </p>

              {ex.skills && (
                <div className="mt-2 flex gap-2 text-lg text-slate-500 dark:text-slate-400">
                  {ex.skills?.map((skill) => (
                    <span
                      className="text-teal-500 dark:text-teal-400"
                      key={skill}
                    >
                      {skill}
                    </span>
                  ))}
                </div>
              )}
            </div>
          ))}
        </div>
      ))}
    </div>
  );
}

function calculateWorkDuration(
  starts_at: {
    day: number;
    month: number;
    year: number;
  },
  ends_at: {
    day: number;
    month: number;
    year: number;
  } | null,
) {
  const startDate = new Date(
    starts_at.year,
    starts_at.month,
    starts_at.day,
  );
  const endDate = ends_at
    ? new Date(ends_at.year, ends_at.month + 1, ends_at.day)
    : new Date();

  const diff = endDate.getTime() - startDate.getTime();
  const year = Math.floor(diff / (1000 * 60 * 60 * 24 * 365));
  const month = Math.floor(
    (diff % (1000 * 60 * 60 * 24 * 365)) / (1000 * 60 * 60 * 24 * 30),
  );

  if (year === 0) {
    return `${month} months`;
  }

  return `${year} yrs ${month} months`;
}

function formateDate(
  date: {
    month: number;
    year: number;
  } | null,
) {
  if (!date) return "Present";

  return `${MONTHS_MAP[date.month]} ${date.year}`;
}

const MONTHS_MAP: {
  [key: string]: string;
} = {
  1: "Jan",
  2: "Feb",
  3: "Mar",
  4: "Apr",
  5: "May",
  6: "Jun",
  7: "Jul",
  8: "Aug",
  9: "Sep",
  10: "Oct",
  11: "Nov",
  12: "Dec",
};
